window.addEventListener("DOMContentLoaded",(()=>{const e=document.getElementById("country-select"),t=document.getElementById("package-select"),a=document.getElementById("total-cost"),l=document.getElementById("weight"),n=document.getElementById("dimensions"),r=[45,48,54,63,71],o=[25,35,45,55,65,90,110],u=[35,45,55,65,75,100,120],c=[25,35,44,53,61],i=[20,30,40,50,60],s=[25,35,45,55,65],d=document.querySelectorAll(".calc__warning-icon"),y=document.querySelectorAll(".calc__warning-text");let p=document.querySelector('[data-input-wrapper="parcel-content"]'),v=p.querySelectorAll(".calc__input-flex"),m=p.querySelector(".calc__input-flex").cloneNode(!0);const h=document.querySelector('[data-btn="add"]'),g=document.querySelector('[data-btn="remove"]'),x=document.getElementById("total-value");let f,S=1,q=0,z=0,K=0;const E=document.querySelector(".calc__modal"),b=E.querySelector(".calc__modal-text"),C=E.querySelector(".calc__modal-subtext"),k=E.querySelector(".calc__modal-close"),_=E.querySelector('[title="adjust"]');let L=e.value,A=t.value;function F(e){for(let t=0;t<e;t++){const e=v[t].querySelector(`#quantity-${t}`);e.addEventListener("input",(()=>{e.style.border="none",e.value<0&&(e.value=0),0==t&&(e.value>5&&(e.value=5),f=5-e.value),1==t&&(e.value>f&&(e.value=f),q=f-e.value),2==t&&(e.value>q&&(e.value=q),z=q-e.value),3==t&&(e.value>z&&(e.value=z),K=z-e.value),4==t&&e.value>K&&(e.value=K)}))}}function w(){v.forEach(((e,t)=>{const a=e.querySelector(`#item-value-${t}`),l=e.querySelector(`#quantity-${t}`);a.addEventListener("input",(()=>{if(""==l.value)l.style.border="2px solid red",a.value="";else{let e=a.value.replace(/[^0-9]/g,"");e>999&&(e=999),a.value="€"+e,N()}}))}))}function N(){let e=0;v.forEach(((t,a)=>{e+=parseFloat(t.querySelector(`#quantity-${a}`).value)*parseFloat(t.querySelector(`#item-value-${a}`).value.slice(1))})),(null==e||Number.isNaN(e))&&(e=""),x.value=e,M(L)}function I(e,t){if("Standard parcel"===e){l.value>20&&(B(),l.style.border="2px solid #f5a200");const e=n.value.trim().split(/[x.,]/);3===e.length&&parseFloat(e[0])+2*parseFloat(e[1])+2*parseFloat(e[2])>300&&(Y(),n.style.border="2px solid #f5a200")}else if("EMS parcel"===e){"Kazakhstan"===t?l.value>20&&(B(),l.style.border="2px solid #f5a200"):"Kyrgyzstan"!==t&&"China"!==t||l.value>30&&(B(),l.style.border="2px solid #f5a200");const e=n.value.trim().split("x");3===e.length&&parseFloat(e[0])+2*parseFloat(e[1])+2*parseFloat(e[2])>300&&(Y(),n.style.border="2px solid #f5a200")}}function M(e){"China"===e?x.value>100&&$():"Kyrgyzstan"!==e&&"Kazakhstan"!==e||x.value>200&&$()}function B(){b.textContent="Your parcel exceeds the weight and/or dimension limit",C.textContent="You may need to pay an additional €30.00",E.style.display="flex"}function Y(){b.textContent="Your parcel exceeds the weight and/or dimension limit",C.textContent="You may need to pay an additional €30.00",E.style.display="flex"}function $(){b.textContent="Your total parcel value is more than €200",C.textContent="You may need to pay duties",E.style.display="flex"}k.addEventListener("click",(()=>{E.style.display="none"})),_.addEventListener("click",(()=>{E.style.display="none"})),E.addEventListener("click",(e=>{const t=e.target;t&&t.classList.contains("calc__modal")&&(E.style.display="none")})),document.addEventListener("keydown",(e=>{"block"===E.style.display&&"Escape"==e.code&&(E.style.display="none")})),F(v.length),w(),d.forEach(((e,t)=>{e.addEventListener("click",(()=>{y.forEach(((e,a)=>{t===a&&e.classList.toggle("calc__warning-text--active")}))}))})),t.addEventListener("change",(()=>{A=t.value,I(A,L),M(L),y.forEach((e=>{if("parcel-length"==e.getAttribute("data-text")){if("Standard parcel"===A)e.textContent="Maximum parcel length - 120 cm";if("EMS parcel"===A)e.textContent="Maximum parcel length - 150 cm"}}))})),e.addEventListener("change",(()=>{L=e.value,I(A,L),M(L)})),l.addEventListener("input",(e=>{l.style.border="none";const t=e.target;I(A,L),t.value<0&&(t.value=0),a.textContent="€"+function(e,t,a){let l;"Standard parcel"===e?(a>0&&a<1&&(l=1),a>=1&&a<=2&&("Kazakhstan"===t&&(l=c[0]),"Kyrgyzstan"===t&&(l=i[0]),"China"===t&&(l=s[0])),a>2&&a<=5&&("Kazakhstan"===t&&(l=c[1]),"Kyrgyzstan"===t&&(l=i[1]),"China"===t&&(l=s[1])),a>5&&a<=10&&("Kazakhstan"===t&&(l=c[2]),"Kyrgyzstan"===t&&(l=i[2]),"China"===t&&(l=s[2])),a>10&&a<=15&&("Kazakhstan"===t&&(l=c[3]),"Kyrgyzstan"===t&&(l=i[3]),"China"===t&&(l=s[3])),a>15&&a<=20&&("Kazakhstan"===t&&(l=c[4]),"Kyrgyzstan"===t&&(l=i[4]),"China"===t&&(l=s[4])),a>20&&("Kazakhstan"===t&&(l=c[4]),"Kyrgyzstan"===t&&(l=i[4]),"China"===t&&(l=s[4]))):"EMS parcel"===e&&(a>0&&a<1&&(l=1),a>=1&&a<=2&&("Kazakhstan"===t&&(l=r[0]),"Kyrgyzstan"===t&&(l=o[0]),"China"===t&&(l=u[0])),a>2&&a<=5&&("Kazakhstan"===t&&(l=r[1]),"Kyrgyzstan"===t&&(l=o[1]),"China"===t&&(l=u[1])),a>5&&a<=10&&("Kazakhstan"===t&&(l=r[2]),"Kyrgyzstan"===t&&(l=o[2]),"China"===t&&(l=u[2])),a>10&&a<=15&&("Kazakhstan"===t&&(l=r[3]),"Kyrgyzstan"===t&&(l=o[3]),"China"===t&&(l=u[3])),a>15&&a<=20&&("Kazakhstan"===t&&(l=r[4]),"Kyrgyzstan"===t&&(l=o[4]),"China"===t&&(l=u[4])),a>20&&a<=25&&("Kazakhstan"===t&&(l=r[4]),"Kyrgyzstan"===t&&(l=o[5]),"China"===t&&(l=u[5])),a>25&&a<=30&&("Kazakhstan"===t&&(l=r[4]),"Kyrgyzstan"===t&&(l=o[6]),"China"===t&&(l=u[6])),a>30&&("Kazakhstan"===t&&(l=r[4]),"Kyrgyzstan"===t&&(l=o[6]),"China"===t&&(l=u[6])));(null==l||Number.isNaN(l))&&(l=0);return l}(A,L,parseInt(t.value))})),n.addEventListener("input",(()=>{n.style.border="none",I(A,L),n.value=n.value.replace(/[^0-9x.,]/g,"");const e=n.value.trim().split(/[x.,]/);console.log(e);let t,a,l=e[0];"Standard parcel"===A?(parseFloat(l)>120&&(l="120",n.value=l),t=e[1],parseFloat(t)>60&&(t="60",n.value=l+"x"+t),a=e[2],parseFloat(a)>60&&(a="60",n.value=l+"x"+t+"x"+a)):"EMS parcel"===A&&(parseFloat(l)>150&&(l="150",n.value=l),t=e[1],parseFloat(t)>150&&(t="150",n.value=l+"x"+t),a=e[2],parseFloat(a)>150&&(a="150",n.value=l+"x"+t+"x"+a)),e.length>3&&(n.value=l+"x"+t+"x"+a)})),h.addEventListener("click",(e=>{if(e.preventDefault(),S<5){const e=v[S-1].querySelector("#quantity-"+(S-1));""==e.value||0==e.value?e.style.border="2px solid red":(S++,m.querySelectorAll(".calc__input-wrapper").forEach(((e,t)=>{0==t&&(e.querySelector("label").setAttribute("for","item-name-"+(S-1)),e.querySelector("input").setAttribute("name","item-name-"+(S-1)),e.querySelector("input").setAttribute("id","item-name-"+(S-1))),1==t&&(e.querySelector("label").setAttribute("for","quantity-"+(S-1)),e.querySelector("input").setAttribute("name","quantity-"+(S-1)),e.querySelector("input").setAttribute("id","quantity-"+(S-1))),2==t&&(e.querySelector("label").setAttribute("for","item-value-"+(S-1)),e.querySelector("input").setAttribute("name","item-value-"+(S-1)),e.querySelector("input").setAttribute("id","item-value-"+(S-1)))})),p.appendChild(m.cloneNode(!0)),p=document.querySelector('[data-input-wrapper="parcel-content"]'),v=p.querySelectorAll(".calc__input-flex"),F(v.length),w())}S>1&&(g.style.display="block")})),g.addEventListener("click",(e=>{e.preventDefault(),S--,p.removeChild(v[v.length-1]),p=document.querySelector('[data-input-wrapper="parcel-content"]'),v=p.querySelectorAll(".calc__input-flex"),F(v.length),w(),N(),1==S&&(g.style.display="none")}))}));